<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Notification</title>
    <style>
        .notification-bell {
            font-size: 30px;
            cursor: pointer;
            position: fixed;
            top: 20px;
            right: 20px;
        }
        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h2>Create Notification</h2>
    <form id="notificationForm">
        <label for="uid">UID:</label>
        <input type="number" id="uid" name="uid" value="1" required><br><br>

        <label for="content">Content:</label>
        <input type="text" id="content" name="content" value="New Notification" required><br><br>

        <label for="type">Type:</label>
        <input type="text" id="type" name="type" value="Info" required><br><br>

        <label for="isRead">Is Read:</label>
        <input type="checkbox" id="isRead" name="isRead" checked><br><br>

        <label for="createdAt">Created At:</label>
        <input type="datetime-local" id="createdAt" name="createdAt" value="2024-11-20T05:47:13" required><br><br>

        <button type="submit">Create Notification</button>
    </form>

    <div class="notification-bell" id="notificationBell">
        üîî
        <div id="notificationCount" class="notification-count">0</div>
    </div>

    <!-- Th√™m th∆∞ vi·ªán SignalR t·ª´ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@5.0.11/dist/browser/signalr.min.js"></script>

    <script>
        // K·∫øt n·ªëi SignalR Hub
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("https://localhost:7134/signalR")  // ƒê·ªãa ch·ªâ SignalR Hub c·ªßa b·∫°n
            .configureLogging(signalR.LogLevel.Information)
            .build();

        connection.start().then(function() {
            console.log("K·∫øt n·ªëi SignalR th√†nh c√¥ng!");
        }).catch(function(err) {
            console.error("L·ªói khi k·∫øt n·ªëi SignalR: ", err);
        });

        connection.on("CreateNotification", function(notificationId, notification) {
        console.log("Th√¥ng b√°o m·ªõi nh·∫≠n ƒë∆∞·ª£c t·ª´ SignalR: ", notification, notificationId);

    // Ki·ªÉm tra xem notification v√† notification.Uid c√≥ t·ªìn t·∫°i kh√¥ng
    if (notification && notification.Uid) {
        // Ki·ªÉm tra UID
        const uidInput = document.getElementById("uid").value;

        // Ki·ªÉm tra s·ª± tr√πng kh·ªõp UID v√† chuy·ªÉn ƒë·ªïi sang chu·ªói n·∫øu c·∫ßn
        if (notification.Uid.toString() === uidInput) {
            let count = parseInt(document.getElementById("notificationCount").innerText) || 0;
            count++;
            document.getElementById("notificationCount").innerText = count;
            console.log(`Th√¥ng b√°o cho UID ${notification.Uid} ƒë√£ ƒë∆∞·ª£c nh·∫≠n.`);
        }
    } else {
        console.error("Th√¥ng b√°o kh√¥ng h·ª£p l·ªá, thi·∫øu thu·ªôc t√≠nh Uid.");
    }
});


        // X·ª≠ l√Ω s·ª± ki·ªán khi form ƒë∆∞·ª£c submit
        document.getElementById("notificationForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            const notificationData = {
                notificationId: 0,
                uid: parseInt(document.getElementById("uid").value),
                content: document.getElementById("content").value,
                type: document.getElementById("type").value,
                isRead: document.getElementById("isRead").checked,
                createdAt: document.getElementById("createdAt").value
            };

            try {
                // G·ªçi API t·∫°o th√¥ng b√°o
                const response = await fetch("https://localhost:7134/api/Notification/Create", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(notificationData),
                });

                if (!response.ok) {
                    throw new Error("Failed to create notification");
                }

                // Th√¥ng b√°o th√†nh c√¥ng
                alert("Notification created successfully!");

            } catch (error) {
                console.error("Error:", error);
            }
        });
    </script>
</body>
</html>
